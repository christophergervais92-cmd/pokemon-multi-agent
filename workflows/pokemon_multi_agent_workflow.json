{
  "name": "LO TCG Multi-Agent System",
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "tags": [],
  "pinData": {},
  "nodes": [
    {
      "id": "schedule",
      "name": "â° Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [200, 400],
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 5
            }
          ]
        }
      }
    },
    {
      "id": "unified-scanner",
      "name": "ğŸ” Unified Stock Scanner",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [420, 400],
      "parameters": {
        "method": "GET",
        "url": "https://pokemon-multi-agent.onrender.com/scanner/unified",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "q",
              "value": "pokemon elite trainer box"
            },
            {
              "name": "zip",
              "value": "90210"
            }
          ]
        },
        "options": {
          "timeout": 120000
        }
      }
    },
    {
      "id": "format-scan-results",
      "name": "ğŸ“¦ Format Scan Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 400],
      "parameters": {
        "jsCode": "// Format unified scanner results for downstream agents\nconst data = $json;\n\nconst products = data.products || data.in_stock_only || [];\nconst inStock = products.filter(p => p.stock);\n\nreturn [{\n  json: {\n    success: data.success !== false,\n    set_name: 'Pokemon TCG',\n    query: data.query || 'pokemon',\n    zip_code: data.zip_code || '90210',\n    sources_checked: data.by_retailer ? Object.keys(data.by_retailer) : [],\n    total_products: data.total || products.length,\n    in_stock_count: data.in_stock_count || inStock.length,\n    products: products,\n    scan_timestamp: new Date().toISOString(),\n  }\n}];"
      }
    },
    {
      "id": "price-agent",
      "name": "ğŸ’° Price Analysis Agent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [900, 400],
      "parameters": {
        "method": "POST",
        "url": "https://pokemon-multi-agent.onrender.com/agent/price",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json) }}",
        "options": {
          "timeout": 60000
        }
      }
    },
    {
      "id": "grading-agent",
      "name": "ğŸ“Š Grading & ROI Agent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1120, 400],
      "parameters": {
        "method": "POST",
        "url": "https://pokemon-multi-agent.onrender.com/agent/grading",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json) }}",
        "options": {
          "timeout": 60000
        }
      }
    },
    {
      "id": "autobuy-agent",
      "name": "ğŸ›’ Auto-Buy Agent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1340, 400],
      "parameters": {
        "method": "POST",
        "url": "https://pokemon-multi-agent.onrender.com/agent/autobuy",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json) }}",
        "options": {
          "timeout": 60000
        }
      }
    },
    {
      "id": "discord-stock",
      "name": "ğŸ“¢ Discord: Stock Alert",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [1560, 280],
      "parameters": {
        "resource": "message",
        "operation": "send",
        "channelId": "={{ $env.DISCORD_CHANNEL_ID || '1404800573206827139' }}",
        "message": "ğŸ“¦ **Pokemon Stock Scan Complete**\n\nğŸ” Query: {{ $json.query || 'pokemon' }}\nğŸ“Š Products: {{ $json.total_products || $json.products?.length || 0 }} | âœ… In Stock: {{ $json.in_stock_count || 0 }}\n\n{{ $json.products?.filter(p => p.stock).slice(0, 5).map(p => `ğŸŸ¢ **${p.name}**\\nğŸª ${p.retailer} - $${p.price}\\nğŸ”— ${p.url || 'N/A'}`).join('\\n\\n') || 'No products in stock' }}\n\n_â±ï¸ {{ new Date().toLocaleString() }} | Next scan in 5 min_"
      }
    },
    {
      "id": "if-deals",
      "name": "ğŸ¤” Has Deals?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1560, 460],
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "deal-check",
              "leftValue": "={{ $json.alerts ? $json.alerts.length : 0 }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        }
      }
    },
    {
      "id": "discord-deals",
      "name": "ğŸ”¥ Discord: Deal Alerts",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [1780, 400],
      "parameters": {
        "resource": "message",
        "operation": "send",
        "channelId": "={{ $env.DISCORD_CHANNEL_ID || '1404800573206827139' }}",
        "message": "ğŸ”¥ **DEAL ALERT - BUY NOW!** ğŸ”¥\n\n{{ $json.alerts?.map(a => `**${a.product_name}**\\nğŸª ${a.retailer} - **$${a.price}**\\nğŸ“ˆ Market: $${a.market_price} (${Math.round(a.delta_pct * 100)}% below!)\\nğŸ›’ ${a.url || 'Link unavailable'}\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`).join('\\n\\n') || 'Check products for deals!' }}"
      }
    },
    {
      "id": "multiuser-notify",
      "name": "ğŸ‘¥ Multi-User Notify",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1780, 560],
      "parameters": {
        "method": "POST",
        "url": "https://pokemon-multi-agent.onrender.com/users/notify",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ products: $json.products?.filter(p => p.stock && p.evaluation?.should_buy) || [] }) }}",
        "options": {
          "timeout": 60000
        }
      }
    },
    {
      "id": "if-purchases",
      "name": "ğŸ’³ Has Purchases?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1560, 640],
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "purchase-check",
              "leftValue": "={{ $json.purchase_count || 0 }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        }
      }
    },
    {
      "id": "discord-purchases",
      "name": "âœ… Discord: Purchase Confirmation",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [1780, 700],
      "parameters": {
        "resource": "message",
        "operation": "send",
        "channelId": "={{ $env.DISCORD_CHANNEL_ID || '1404800573206827139' }}",
        "message": "âœ… **AUTO-BUY EXECUTED** âœ…\n\n{{ $json.simulation_mode ? 'âš ï¸ SIMULATION MODE' : 'ğŸ’³ REAL PURCHASE' }}\n\nPurchases: {{ $json.purchase_count }}\nDaily: ${{ $json.daily_spend || 0 }} / ${{ $json.daily_limit || 500 }}\n\n{{ $json.purchases?.filter(p => p.success).map(p => `âœ… ${p.product} @ ${p.retailer} - $${p.price}`).join('\\n') || 'No purchases' }}"
      }
    },
    {
      "id": "market-analysis",
      "name": "ğŸ“Š Market Analysis Agent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [420, 700],
      "parameters": {
        "method": "GET",
        "url": "https://pokemon-multi-agent.onrender.com/market/analysis",
        "options": {
          "timeout": 60000
        }
      }
    },
    {
      "id": "discord-market",
      "name": "ğŸ“Š Discord: Market Report",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [660, 700],
      "parameters": {
        "resource": "message",
        "operation": "send",
        "channelId": "={{ $env.DISCORD_CHANNEL_ID || '1404800573206827139' }}",
        "message": "ğŸ“Š **MARKET REPORT**\n\n{{ $json.overall_sentiment?.emoji || 'ğŸ“Š' }} **{{ $json.overall_sentiment?.sentiment?.toUpperCase() || 'NEUTRAL' }}**\n{{ $json.overall_sentiment?.description || 'Market data loading...' }}\n\nğŸ“¦ Sealed: {{ $json.category_sentiments?.sealed?.average_change_pct || 0 }}%\nğŸƒ Raw: {{ $json.category_sentiments?.raw?.average_change_pct || 0 }}%\nğŸ’ Slabs: {{ $json.category_sentiments?.slabs?.average_change_pct || 0 }}%"
      }
    },
    {
      "id": "webhook-grading",
      "name": "ğŸ“· Card Image Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 900],
      "parameters": {
        "path": "grade-card",
        "httpMethod": "POST",
        "responseMode": "lastNode",
        "options": {}
      },
      "webhookId": "grade-card-webhook"
    },
    {
      "id": "ai-visual-grading",
      "name": "ğŸ”¬ AI Visual Grading Agent",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [420, 900],
      "parameters": {
        "method": "POST",
        "url": "https://pokemon-multi-agent.onrender.com/grader/analyze",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.body || $json) }}",
        "options": {
          "timeout": 120000
        }
      }
    },
    {
      "id": "discord-grading",
      "name": "ğŸ”¬ Discord: Grading Result",
      "type": "n8n-nodes-base.discord",
      "typeVersion": 2,
      "position": [660, 900],
      "parameters": {
        "resource": "message",
        "operation": "send",
        "channelId": "={{ $env.DISCORD_CHANNEL_ID || '1404800573206827139' }}",
        "message": "ğŸ´ **CARD GRADING REPORT**\n\nğŸ“› {{ $json.card_name || 'Unknown Card' }}\n\nğŸ“Š **GRADES**\nâ€¢ PSA: {{ $json.predicted_grades?.PSA || 'N/A' }}\nâ€¢ CGC: {{ $json.predicted_grades?.CGC || 'N/A' }}\nâ€¢ BGS: {{ $json.predicted_grades?.BGS || 'N/A' }}\nâ€¢ Confidence: {{ Math.round(($json.grade_confidence || 0) * 100) }}%\n\nğŸ“ **SUBGRADES**\nâ€¢ Centering: {{ $json.subgrades?.centering || 'N/A' }}\nâ€¢ Corners: {{ $json.subgrades?.corners || 'N/A' }}\nâ€¢ Edges: {{ $json.subgrades?.edges || 'N/A' }}\nâ€¢ Surface: {{ $json.subgrades?.surface || 'N/A' }}\n\nğŸ’° Worth grading: {{ $json.worth_grading ? 'YES âœ…' : 'NO âŒ' }}"
      }
    },
    {
      "id": "grading-response",
      "name": "ğŸ“¤ Return Grading Result",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [900, 900],
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      }
    },
    {
      "id": "webhook-ai-chat",
      "name": "ğŸ¤– AI Chat Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [200, 1100],
      "parameters": {
        "path": "ai-chat",
        "httpMethod": "POST",
        "responseMode": "lastNode",
        "options": {}
      },
      "webhookId": "ai-chat-webhook"
    },
    {
      "id": "ai-assistant",
      "name": "ğŸ¤– AI Pokemon Assistant",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [420, 1100],
      "parameters": {
        "method": "POST",
        "url": "https://pokemon-multi-agent.onrender.com/ai/chat",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ message: $json.body?.message || $json.message || 'Hello' }) }}",
        "options": {
          "timeout": 60000
        }
      }
    },
    {
      "id": "ai-chat-response",
      "name": "ğŸ“¤ Return AI Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [660, 1100],
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      }
    },
    {
      "id": "health-check",
      "name": "â¤ï¸ Health Check",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [200, 200],
      "parameters": {
        "method": "GET",
        "url": "https://pokemon-multi-agent.onrender.com/health",
        "options": {
          "timeout": 30000
        }
      }
    }
  ],
  "connections": {
    "â° Schedule Trigger": {
      "main": [
        [
          { "node": "ğŸ” Unified Stock Scanner", "type": "main", "index": 0 },
          { "node": "ğŸ“Š Market Analysis Agent", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ” Unified Stock Scanner": {
      "main": [
        [
          { "node": "ğŸ“¦ Format Scan Results", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ“¦ Format Scan Results": {
      "main": [
        [
          { "node": "ğŸ’° Price Analysis Agent", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ’° Price Analysis Agent": {
      "main": [
        [
          { "node": "ğŸ“Š Grading & ROI Agent", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ“Š Grading & ROI Agent": {
      "main": [
        [
          { "node": "ğŸ›’ Auto-Buy Agent", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ›’ Auto-Buy Agent": {
      "main": [
        [
          { "node": "ğŸ“¢ Discord: Stock Alert", "type": "main", "index": 0 },
          { "node": "ğŸ¤” Has Deals?", "type": "main", "index": 0 },
          { "node": "ğŸ’³ Has Purchases?", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ¤” Has Deals?": {
      "main": [
        [
          { "node": "ğŸ”¥ Discord: Deal Alerts", "type": "main", "index": 0 },
          { "node": "ğŸ‘¥ Multi-User Notify", "type": "main", "index": 0 }
        ],
        []
      ]
    },
    "ğŸ’³ Has Purchases?": {
      "main": [
        [
          { "node": "âœ… Discord: Purchase Confirmation", "type": "main", "index": 0 }
        ],
        []
      ]
    },
    "ğŸ“Š Market Analysis Agent": {
      "main": [
        [
          { "node": "ğŸ“Š Discord: Market Report", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ“· Card Image Webhook": {
      "main": [
        [
          { "node": "ğŸ”¬ AI Visual Grading Agent", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ”¬ AI Visual Grading Agent": {
      "main": [
        [
          { "node": "ğŸ”¬ Discord: Grading Result", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ”¬ Discord: Grading Result": {
      "main": [
        [
          { "node": "ğŸ“¤ Return Grading Result", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ¤– AI Chat Webhook": {
      "main": [
        [
          { "node": "ğŸ¤– AI Pokemon Assistant", "type": "main", "index": 0 }
        ]
      ]
    },
    "ğŸ¤– AI Pokemon Assistant": {
      "main": [
        [
          { "node": "ğŸ“¤ Return AI Response", "type": "main", "index": 0 }
        ]
      ]
    }
  }
}
